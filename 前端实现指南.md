# å‰ç«¯å®ç°æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»æ±¡æ°´å¤„ç†ç›‘æµ‹ç³»ç»Ÿå‰ç«¯çš„å®ç°æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æŠ€æœ¯é€‰å‹ã€æ¶æ„è®¾è®¡ã€åŠŸèƒ½æ¨¡å—å®ç°ç­‰å†…å®¹ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **Vue.js 3.x**: å‰ç«¯æ ¸å¿ƒæ¡†æ¶
- **Vue Router 4.x**: è·¯ç”±ç®¡ç†
- **Pinia**: çŠ¶æ€ç®¡ç†
- **Axios**: HTTPå®¢æˆ·ç«¯
- **Element Plus**: UIç»„ä»¶åº“
- **ECharts 5.x**: æ•°æ®å¯è§†åŒ–
- **WebSocket**: å®æ—¶é€šä¿¡

### å¼€å‘å·¥å…·
- **Vite**: æ„å»ºå·¥å…·
- **TypeScript**: ç±»å‹æ”¯æŒ
- **ESLint**: ä»£ç æ£€æŸ¥
- **Prettier**: ä»£ç æ ¼å¼åŒ–
- **Sass**: CSSé¢„å¤„ç†å™¨

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
frontend/
â”œâ”€â”€ public/                         # é™æ€èµ„æº
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                        # APIæ¥å£
â”‚   â”‚   â”œâ”€â”€ auth.ts                 # è®¤è¯æ¥å£
â”‚   â”‚   â”œâ”€â”€ monitor.ts              # ç›‘æ§æ¥å£
â”‚   â”‚   â”œâ”€â”€ system.ts               # ç³»ç»Ÿæ¥å£
â”‚   â”‚   â””â”€â”€ index.ts                # APIç»Ÿä¸€å‡ºå£
â”‚   â”œâ”€â”€ assets/                     # èµ„æºæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ images/                 # å›¾ç‰‡
â”‚   â”‚   â”œâ”€â”€ icons/                  # å›¾æ ‡
â”‚   â”‚   â””â”€â”€ styles/                 # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ components/                 # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/                 # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ charts/                 # å›¾è¡¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ forms/                  # è¡¨å•ç»„ä»¶
â”‚   â”‚   â””â”€â”€ layout/                 # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ router/                     # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ modules/                # è·¯ç”±æ¨¡å—
â”‚   â”‚   â””â”€â”€ index.ts                # è·¯ç”±å…¥å£
â”‚   â”œâ”€â”€ stores/                     # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ modules/                # çŠ¶æ€æ¨¡å—
â”‚   â”‚   â””â”€â”€ index.ts                # çŠ¶æ€å…¥å£
â”‚   â”œâ”€â”€ types/                      # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ api.ts                  # APIç±»å‹
â”‚   â”‚   â”œâ”€â”€ common.ts               # é€šç”¨ç±»å‹
â”‚   â”‚   â””â”€â”€ index.ts                # ç±»å‹å…¥å£
â”‚   â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ auth.ts                 # è®¤è¯å·¥å…·
â”‚   â”‚   â”œâ”€â”€ request.ts              # è¯·æ±‚å·¥å…·
â”‚   â”‚   â”œâ”€â”€ storage.ts              # å­˜å‚¨å·¥å…·
â”‚   â”‚   â””â”€â”€ index.ts                # å·¥å…·å…¥å£
â”‚   â”œâ”€â”€ views/                      # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ login/                  # ç™»å½•é¡µ
â”‚   â”‚   â”œâ”€â”€ dashboard/              # ä»ªè¡¨ç›˜
â”‚   â”‚   â”œâ”€â”€ monitor/                # ç›‘æ§é¡µé¢
â”‚   â”‚   â”œâ”€â”€ statistics/             # ç»Ÿè®¡é¡µé¢
â”‚   â”‚   â”œâ”€â”€ system/                 # ç³»ç»Ÿç®¡ç†
â”‚   â”‚   â””â”€â”€ profile/                # ä¸ªäººä¸­å¿ƒ
â”‚   â”œâ”€â”€ App.vue                     # æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.ts                     # åº”ç”¨å…¥å£
â”œâ”€â”€ package.json                    # é¡¹ç›®é…ç½®
â”œâ”€â”€ vite.config.ts                  # Viteé…ç½®
â”œâ”€â”€ tsconfig.json                   # TypeScripté…ç½®
â””â”€â”€ README.md                       # é¡¹ç›®è¯´æ˜
```

## ğŸ”§ æ ¸å¿ƒé…ç½®

### 1. Viteé…ç½® (vite.config.ts)

```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@/components': resolve(__dirname, 'src/components'),
      '@/views': resolve(__dirname, 'src/views'),
      '@/utils': resolve(__dirname, 'src/utils'),
      '@/api': resolve(__dirname, 'src/api'),
      '@/stores': resolve(__dirname, 'src/stores')
    }
  },
  server: {
    port: 3000,
    open: true,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  },
  build: {
    outDir: 'dist',
    sourcemap: false,
    rollupOptions: {
      output: {
        chunkFileNames: 'js/[name]-[hash].js',
        entryFileNames: 'js/[name]-[hash].js',
        assetFileNames: '[ext]/[name]-[hash].[ext]'
      }
    }
  }
})
```

### 2. è·¯ç”±é…ç½® (src/router/index.ts)

```typescript
import { createRouter, createWebHistory } from 'vue-router'
import type { RouteRecordRaw } from 'vue-router'
import { useAuthStore } from '@/stores/auth'

const routes: RouteRecordRaw[] = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/login/index.vue'),
    meta: { title: 'ç™»å½•', requiresAuth: false }
  },
  {
    path: '/',
    component: () => import('@/components/layout/index.vue'),
    meta: { requiresAuth: true },
    children: [
      {
        path: '',
        name: 'Dashboard',
        component: () => import('@/views/dashboard/index.vue'),
        meta: { title: 'ä»ªè¡¨ç›˜', icon: 'dashboard' }
      },
      {
        path: '/monitor',
        name: 'Monitor',
        component: () => import('@/views/monitor/index.vue'),
        meta: { title: 'å®æ—¶ç›‘æ§', icon: 'monitor' }
      },
      {
        path: '/statistics',
        name: 'Statistics',
        component: () => import('@/views/statistics/index.vue'),
        meta: { title: 'æ•°æ®ç»Ÿè®¡', icon: 'statistics' }
      },
      {
        path: '/system',
        name: 'System',
        component: () => import('@/views/system/index.vue'),
        meta: { title: 'ç³»ç»Ÿç®¡ç†', icon: 'system', roles: ['ADMIN'] }
      },
      {
        path: '/profile',
        name: 'Profile',
        component: () => import('@/views/profile/index.vue'),
        meta: { title: 'ä¸ªäººä¸­å¿ƒ', icon: 'user' }
      }
    ]
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

// è·¯ç”±å®ˆå«
router.beforeEach((to, from, next) => {
  const authStore = useAuthStore()

  if (to.meta.requiresAuth && !authStore.isLoggedIn) {
    next('/login')
  } else if (to.path === '/login' && authStore.isLoggedIn) {
    next('/')
  } else {
    next()
  }
})

export default router
```

### 3. çŠ¶æ€ç®¡ç† (src/stores/auth.ts)

```typescript
import { defineStore } from 'pinia'
import { login, logout, getUserInfo } from '@/api/auth'
import { setToken, removeToken } from '@/utils/auth'
import type { LoginForm, UserInfo } from '@/types'

interface AuthState {
  token: string
  userInfo: UserInfo | null
  permissions: string[]
}

export const useAuthStore = defineStore('auth', {
  state: (): AuthState => ({
    token: localStorage.getItem('token') || '',
    userInfo: null,
    permissions: []
  }),

  getters: {
    isLoggedIn: (state) => !!state.token,
    username: (state) => state.userInfo?.username || '',
    role: (state) => state.userInfo?.role || ''
  },

  actions: {
    async login(loginForm: LoginForm) {
      try {
        const response = await login(loginForm)
        const { token } = response.data

        this.token = token
        setToken(token)

        await this.getUserInfo()
        return Promise.resolve()
      } catch (error) {
        return Promise.reject(error)
      }
    },

    async getUserInfo() {
      try {
        const response = await getUserInfo()
        this.userInfo = response.data
        return Promise.resolve()
      } catch (error) {
        return Promise.reject(error)
      }
    },

    async logout() {
      try {
        await logout()
      } finally {
        this.token = ''
        this.userInfo = null
        this.permissions = []
        removeToken()
      }
    }
  }
})
```

## ğŸ¨ ç»„ä»¶å¼€å‘

### 1. å¸ƒå±€ç»„ä»¶ (src/components/layout/index.vue)

```vue
<template>
  <div class="layout-container">
    <!-- ä¾§è¾¹æ  -->
    <div class="sidebar" :class="{ collapsed: sidebarCollapsed }">
      <div class="logo">
        <img src="@/assets/logo.png" alt="logo" />
        <span v-show="!sidebarCollapsed">æ±¡æ°´ç›‘æµ‹ç³»ç»Ÿ</span>
      </div>

      <el-menu
        :default-active="$route.path"
        class="sidebar-menu"
        :collapse="sidebarCollapsed"
        router
      >
        <template v-for="route in menuRoutes" :key="route.path">
          <el-menu-item
            v-if="hasPermission(route)"
            :index="route.path"
          >
            <el-icon><component :is="route.meta.icon" /></el-icon>
            <template #title>{{ route.meta.title }}</template>
          </el-menu-item>
        </template>
      </el-menu>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-container">
      <!-- é¡¶éƒ¨å¯¼èˆª -->
      <div class="header">
        <div class="header-left">
          <el-button
            type="text"
            @click="toggleSidebar"
            class="collapse-btn"
          >
            <el-icon><Fold v-if="!sidebarCollapsed" /><Expand v-else /></el-icon>
          </el-button>

          <el-breadcrumb separator="/">
            <el-breadcrumb-item
              v-for="item in breadcrumbs"
              :key="item.path"
              :to="item.path"
            >
              {{ item.title }}
            </el-breadcrumb-item>
          </el-breadcrumb>
        </div>

        <div class="header-right">
          <!-- é€šçŸ¥ -->
          <el-badge :value="notificationCount" class="notification-badge">
            <el-button type="text" @click="showNotifications">
              <el-icon><Bell /></el-icon>
            </el-button>
          </el-badge>

          <!-- ç”¨æˆ·ä¿¡æ¯ -->
          <el-dropdown @command="handleCommand">
            <div class="user-info">
              <el-avatar :size="32" :src="userInfo?.avatar" />
              <span class="username">{{ username }}</span>
              <el-icon><CaretBottom /></el-icon>
            </div>

            <template #dropdown>
              <el-dropdown-menu>
                <el-dropdown-item command="profile">
                  <el-icon><User /></el-icon>ä¸ªäººä¸­å¿ƒ
                </el-dropdown-item>
                <el-dropdown-item command="settings">
                  <el-icon><Setting /></el-icon>ç³»ç»Ÿè®¾ç½®
                </el-dropdown-item>
                <el-dropdown-item divided command="logout">
                  <el-icon><SwitchButton /></el-icon>é€€å‡ºç™»å½•
                </el-dropdown-item>
              </el-dropdown-menu>
            </template>
          </el-dropdown>
        </div>
      </div>

      <!-- é¡µé¢å†…å®¹ -->
      <div class="content">
        <router-view v-slot="{ Component }">
          <transition name="fade" mode="out-in">
            <component :is="Component" />
          </transition>
        </router-view>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed, ref } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { useAuthStore } from '@/stores/auth'

const route = useRoute()
const router = useRouter()
const authStore = useAuthStore()

const sidebarCollapsed = ref(false)
const notificationCount = ref(0)

// èœå•è·¯ç”±
const menuRoutes = computed(() => {
  return router.getRoutes().filter(route =>
    route.meta?.title && route.meta?.icon && route.path !== '/login'
  )
})

// é¢åŒ…å±‘å¯¼èˆª
const breadcrumbs = computed(() => {
  const matched = route.matched.filter(item => item.meta?.title)
  return matched.map(item => ({
    path: item.path,
    title: item.meta?.title
  }))
})

const userInfo = computed(() => authStore.userInfo)
const username = computed(() => authStore.username)

// æƒé™æ£€æŸ¥
const hasPermission = (route: any) => {
  if (!route.meta?.roles) return true
  return route.meta.roles.includes(authStore.role)
}

// åˆ‡æ¢ä¾§è¾¹æ 
const toggleSidebar = () => {
  sidebarCollapsed.value = !sidebarCollapsed.value
}

// æ˜¾ç¤ºé€šçŸ¥
const showNotifications = () => {
  // TODO: å®ç°é€šçŸ¥åŠŸèƒ½
}

// å¤„ç†ç”¨æˆ·ä¸‹æ‹‰èœå•å‘½ä»¤
const handleCommand = (command: string) => {
  switch (command) {
    case 'profile':
      router.push('/profile')
      break
    case 'settings':
      // TODO: å®ç°è®¾ç½®åŠŸèƒ½
      break
    case 'logout':
      authStore.logout()
      router.push('/login')
      break
  }
}
</script>

<style lang="scss" scoped>
.layout-container {
  display: flex;
  height: 100vh;
}

.sidebar {
  width: 240px;
  background: #304156;
  transition: width 0.3s;

  &.collapsed {
    width: 64px;
  }

  .logo {
    height: 60px;
    display: flex;
    align-items: center;
    padding: 0 20px;
    color: #fff;
    font-size: 18px;
    font-weight: bold;

    img {
      width: 32px;
      height: 32px;
      margin-right: 12px;
    }
  }

  .sidebar-menu {
    border: none;
    background: #304156;

    :deep(.el-menu-item) {
      color: #bfcbd9;

      &:hover {
        background: #263445 !important;
        color: #fff !important;
      }

      &.is-active {
        background: #409eff !important;
        color: #fff !important;
      }
    }
  }
}

.main-container {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.header {
  height: 60px;
  background: #fff;
  border-bottom: 1px solid #e4e7ed;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;

  .header-left {
    display: flex;
    align-items: center;

    .collapse-btn {
      margin-right: 20px;
    }
  }

  .header-right {
    display: flex;
    align-items: center;

    .notification-badge {
      margin-right: 20px;
    }

    .user-info {
      display: flex;
      align-items: center;
      cursor: pointer;

      .username {
        margin: 0 8px;
      }
    }
  }
}

.content {
  flex: 1;
  padding: 20px;
  background: #f0f2f5;
  overflow-y: auto;
}

.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s ease;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}
</style>
```

### 2. å›¾è¡¨ç»„ä»¶ (src/components/charts/EnvironmentChart.vue)

```vue
<template>
  <div class="environment-chart">
    <div class="chart-header">
      <h3>{{ title }}</h3>
      <div class="chart-controls">
        <el-select v-model="timeRange" @change="handleTimeRangeChange">
          <el-option label="æœ€è¿‘1å°æ—¶" value="1h" />
          <el-option label="æœ€è¿‘6å°æ—¶" value="6h" />
          <el-option label="æœ€è¿‘24å°æ—¶" value="24h" />
          <el-option label="æœ€è¿‘7å¤©" value="7d" />
        </el-select>

        <el-button-group>
          <el-button
            v-for="metric in metrics"
            :key="metric.key"
            :type="selectedMetrics.includes(metric.key) ? 'primary' : 'default'"
            @click="toggleMetric(metric.key)"
          >
            {{ metric.label }}
          </el-button>
        </el-button-group>
      </div>
    </div>

    <div ref="chartRef" class="chart-container" />
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted, watch } from 'vue'
import * as echarts from 'echarts'
import { getHistoryData } from '@/api/monitor'
import type { LabEnvironmentData } from '@/types'

interface Props {
  labId: number
  title: string
}

interface Metric {
  key: keyof LabEnvironmentData
  label: string
  color: string
  unit: string
}

const props = defineProps<Props>()

const chartRef = ref<HTMLElement>()
const timeRange = ref('6h')
const selectedMetrics = ref<string[]>(['temperature', 'humidity'])

const metrics: Metric[] = [
  { key: 'temperature', label: 'æ¸©åº¦', color: '#ff6b6b', unit: 'Â°C' },
  { key: 'humidity', label: 'æ¹¿åº¦', color: '#4ecdc4', unit: '%' },
  { key: 'phValue', label: 'pHå€¼', color: '#45b7d1', unit: '' },
  { key: 'dissolvedOxygen', label: 'æº¶è§£æ°§', color: '#96ceb4', unit: 'mg/L' },
  { key: 'turbidity', label: 'æµŠåº¦', color: '#feca57', unit: 'NTU' }
]

let chart: echarts.ECharts | null = null
let ws: WebSocket | null = null

// åˆå§‹åŒ–å›¾è¡¨
const initChart = () => {
  if (!chartRef.value) return

  chart = echarts.init(chartRef.value)

  const option = {
    tooltip: {
      trigger: 'axis',
      axisPointer: {
        type: 'cross'
      }
    },
    legend: {
      data: selectedMetrics.value.map(key =>
        metrics.find(m => m.key === key)?.label
      )
    },
    grid: {
      left: '3%',
      right: '4%',
      bottom: '3%',
      containLabel: true
    },
    xAxis: {
      type: 'time',
      boundaryGap: false
    },
    yAxis: {
      type: 'value'
    },
    series: []
  }

  chart.setOption(option)
}

// åŠ è½½å†å²æ•°æ®
const loadHistoryData = async () => {
  try {
    const endTime = new Date()
    const startTime = getStartTime(timeRange.value, endTime)

    const response = await getHistoryData({
      labId: props.labId,
      startTime: startTime.toISOString(),
      endTime: endTime.toISOString()
    })

    updateChart(response.data)
  } catch (error) {
    console.error('åŠ è½½å†å²æ•°æ®å¤±è´¥:', error)
  }
}

// æ›´æ–°å›¾è¡¨æ•°æ®
const updateChart = (data: LabEnvironmentData[]) => {
  if (!chart) return

  const series = selectedMetrics.value.map(metricKey => {
    const metric = metrics.find(m => m.key === metricKey)
    if (!metric) return null

    return {
      name: metric.label,
      type: 'line',
      smooth: true,
      symbol: 'circle',
      symbolSize: 6,
      data: data.map(item => [
        item.createdAt,
        item[metricKey]
      ]).filter(item => item[1] !== null),
      itemStyle: {
        color: metric.color
      }
    }
  }).filter(Boolean)

  chart.setOption({
    series
  })
}

// è·å–å¼€å§‹æ—¶é—´
const getStartTime = (range: string, endTime: Date): Date => {
  const startTime = new Date(endTime)

  switch (range) {
    case '1h':
      startTime.setHours(startTime.getHours() - 1)
      break
    case '6h':
      startTime.setHours(startTime.getHours() - 6)
      break
    case '24h':
      startTime.setDate(startTime.getDate() - 1)
      break
    case '7d':
      startTime.setDate(startTime.getDate() - 7)
      break
  }

  return startTime
}

// å¤„ç†æ—¶é—´èŒƒå›´å˜åŒ–
const handleTimeRangeChange = () => {
  loadHistoryData()
}

// åˆ‡æ¢æŒ‡æ ‡
const toggleMetric = (metricKey: string) => {
  const index = selectedMetrics.value.indexOf(metricKey)
  if (index > -1) {
    selectedMetrics.value.splice(index, 1)
  } else {
    selectedMetrics.value.push(metricKey)
  }

  // æ›´æ–°å›¾è¡¨é…ç½®
  if (chart) {
    chart.setOption({
      legend: {
        data: selectedMetrics.value.map(key =>
          metrics.find(m => m.key === key)?.label
        )
      }
    })
  }

  loadHistoryData()
}

// å»ºç«‹WebSocketè¿æ¥
const connectWebSocket = () => {
  const wsUrl = `ws://localhost:8080/ws/realtime`
  ws = new WebSocket(wsUrl)

  ws.onopen = () => {
    console.log('WebSocketè¿æ¥å·²å»ºç«‹')
  }

  ws.onmessage = (event) => {
    try {
      const data = JSON.parse(event.data)

      // åªå¤„ç†å½“å‰å®éªŒå®¤çš„æ•°æ®
      if (data.labId === props.labId) {
        addRealtimeData(data)
      }
    } catch (error) {
      console.error('WebSocketæ¶ˆæ¯è§£æå¤±è´¥:', error)
    }
  }

  ws.onerror = (error) => {
    console.error('WebSocketé”™è¯¯:', error)
  }

  ws.onclose = () => {
    console.log('WebSocketè¿æ¥å·²å…³é—­')
    // 5ç§’åé‡è¿
    setTimeout(connectWebSocket, 5000)
  }
}

// æ·»åŠ å®æ—¶æ•°æ®
const addRealtimeData = (data: LabEnvironmentData) => {
  if (!chart) return

  selectedMetrics.value.forEach(metricKey => {
    const metric = metrics.find(m => m.key === metricKey)
    if (!metric || data[metricKey] === null) return

    const seriesIndex = selectedMetrics.value.indexOf(metricKey)
    const series = chart?.getOption().series?.[seriesIndex]

    if (series && Array.isArray(series.data)) {
      // æ·»åŠ æ–°æ•°æ®ç‚¹
      series.data.push([data.createdAt, data[metricKey]])

      // ä¿æŒæœ€è¿‘100ä¸ªæ•°æ®ç‚¹
      if (series.data.length > 100) {
        series.data.shift()
      }
    }
  })

  chart.setOption({
    series: chart.getOption().series
  })
}

// ç›‘å¬çª—å£å¤§å°å˜åŒ–
const handleResize = () => {
  chart?.resize()
}

onMounted(() => {
  initChart()
  loadHistoryData()
  connectWebSocket()
  window.addEventListener('resize', handleResize)
})

onUnmounted(() => {
  chart?.dispose()
  ws?.close()
  window.removeEventListener('resize', handleResize)
})

// ç›‘å¬é€‰ä¸­çš„æŒ‡æ ‡å˜åŒ–
watch(selectedMetrics, () => {
  loadHistoryData()
})
</script>

<style lang="scss" scoped>
.environment-chart {
  background: #fff;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;

  h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
  }
}

.chart-controls {
  display: flex;
  gap: 12px;
  align-items: center;
}

.chart-container {
  width: 100%;
  height: 400px;
}
</style>
```

## ğŸ“± é¡µé¢å®ç°

### 1. ä»ªè¡¨ç›˜é¡µé¢ (src/views/dashboard/index.vue)

```vue
<template>
  <div class="dashboard">
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-cards">
      <el-row :gutter="20">
        <el-col :span="6" v-for="stat in stats" :key="stat.title">
          <el-card class="stat-card">
            <div class="stat-content">
              <div class="stat-icon" :style="{ backgroundColor: stat.color }">
                <el-icon :size="24"><component :is="stat.icon" /></el-icon>
              </div>
              <div class="stat-info">
                <div class="stat-title">{{ stat.title }}</div>
                <div class="stat-value">{{ stat.value }}</div>
                <div class="stat-trend" :class="stat.trend">
                  <el-icon><ArrowUp v-if="stat.trend === 'up'" /><ArrowDown v-else /></el-icon>
                  {{ stat.change }}
                </div>
              </div>
            </div>
          </el-card>
        </el-col>
      </el-row>
    </div>

    <!-- å®æ—¶ç›‘æ§ -->
    <div class="monitoring-section">
      <el-row :gutter="20">
        <el-col :span="16">
          <el-card title="å®éªŒå®¤å®æ—¶æ•°æ®">
            <template #title>
              <span>å®éªŒå®¤å®æ—¶æ•°æ®</span>
              <el-tag type="success" size="small" style="margin-left: 12px">
                å®æ—¶æ›´æ–°ä¸­
              </el-tag>
            </template>

            <el-tabs v-model="activeLab" @tab-change="handleLabChange">
              <el-tab-pane
                v-for="lab in laboratories"
                :key="lab.id"
                :label="lab.name"
                :name="lab.id.toString()"
              >
                <EnvironmentChart
                  :lab-id="lab.id"
                  :title="`${lab.name} - ç¯å¢ƒå‚æ•°ç›‘æ§`"
                />
              </el-tab-pane>
            </el-tabs>
          </el-card>
        </el-col>

        <el-col :span="8">
          <el-card title="å‘Šè­¦ä¿¡æ¯">
            <template #title>
              <span>å‘Šè­¦ä¿¡æ¯</span>
              <el-badge :value="unreadAlarms.length" class="alarm-badge" />
            </template>

            <div class="alarm-list">
              <div
                v-for="alarm in recentAlarms"
                :key="alarm.id"
                class="alarm-item"
                :class="alarm.alarmLevel.toLowerCase()"
              >
                <div class="alarm-header">
                  <el-tag
                    :type="getAlarmTagType(alarm.alarmLevel)"
                    size="small"
                  >
                    {{ alarm.alarmLevel }}
                  </el-tag>
                  <span class="alarm-time">{{ formatTime(alarm.createdAt) }}</span>
                </div>
                <div class="alarm-content">{{ alarm.alarmMessage }}</div>
                <div class="alarm-lab">{{ getLabName(alarm.labId) }}</div>
              </div>

              <el-empty
                v-if="recentAlarms.length === 0"
                description="æš‚æ— å‘Šè­¦ä¿¡æ¯"
                :image-size="100"
              />
            </div>
          </el-card>
        </el-col>
      </el-row>
    </div>

    <!-- ç»Ÿè®¡å›¾è¡¨ -->
    <div class="charts-section">
      <el-row :gutter="20">
        <el-col :span="12">
          <el-card title="24å°æ—¶æ•°æ®è¶‹åŠ¿">
            <TrendChart :lab-id="activeLabId" />
          </el-card>
        </el-col>

        <el-col :span="12">
          <el-card title="å®éªŒå®¤å¥åº·åº¦">
            <HealthChart :laboratories="laboratories" />
          </el-card>
        </el-col>
      </el-row>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, computed } from 'vue'
import { useAuthStore } from '@/stores/auth'
import { getLaboratories, getRecentAlarms } from '@/api/monitor'
import EnvironmentChart from '@/components/charts/EnvironmentChart.vue'
import TrendChart from '@/components/charts/TrendChart.vue'
import HealthChart from '@/components/charts/HealthChart.vue'
import type { Laboratory, LabAlarm } from '@/types'
import { formatDistanceToNow } from 'date-fns'
import { zhCN } from 'date-fns/locale'

const authStore = useAuthStore()

// å“åº”å¼æ•°æ®
const activeLab = ref('1')
const laboratories = ref<Laboratory[]>([])
const recentAlarms = ref<LabAlarm[]>([])
const stats = ref([
  {
    title: 'åœ¨çº¿å®éªŒå®¤',
    value: '0',
    change: '+2',
    trend: 'up',
    color: '#67c23a',
    icon: 'Monitor'
  },
  {
    title: 'ä»Šæ—¥å‘Šè­¦',
    value: '0',
    change: '-15%',
    trend: 'down',
    color: '#f56c6c',
    icon: 'Warning'
  },
  {
    title: 'æ•°æ®é‡‡é›†ç‚¹',
    value: '0',
    change: '+8',
    trend: 'up',
    color: '#409eff',
    icon: 'DataLine'
  },
  {
    title: 'ç³»ç»Ÿå¥åº·åº¦',
    value: '0%',
    change: '+2%',
    trend: 'up',
    color: '#e6a23c',
    icon: 'SuccessFilled'
  }
])

// è®¡ç®—å±æ€§
const activeLabId = computed(() => parseInt(activeLab.value))
const unreadAlarms = computed(() =>
  recentAlarms.value.filter(alarm => !alarm.read)
)

// åŠ è½½å®éªŒå®¤æ•°æ®
const loadLaboratories = async () => {
  try {
    const response = await getLaboratories()
    laboratories.value = response.data

    // æ›´æ–°ç»Ÿè®¡æ•°æ®
    stats.value[0].value = laboratories.value.length.toString()
  } catch (error) {
    console.error('åŠ è½½å®éªŒå®¤æ•°æ®å¤±è´¥:', error)
  }
}

// åŠ è½½å‘Šè­¦æ•°æ®
const loadAlarms = async () => {
  try {
    const response = await getRecentAlarms()
    recentAlarms.value = response.data

    // æ›´æ–°ç»Ÿè®¡æ•°æ®
    stats.value[1].value = recentAlarms.value.length.toString()
  } catch (error) {
    console.error('åŠ è½½å‘Šè­¦æ•°æ®å¤±è´¥:', error)
  }
}

// å¤„ç†å®éªŒå®¤åˆ‡æ¢
const handleLabChange = (labId: string) => {
  // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ åˆ‡æ¢é€»è¾‘
}

// è·å–å‘Šè­¦æ ‡ç­¾ç±»å‹
const getAlarmTagType = (level: string) => {
  switch (level) {
    case 'HIGH': return 'danger'
    case 'MEDIUM': return 'warning'
    case 'LOW': return 'info'
    default: return 'info'
  }
}

// æ ¼å¼åŒ–æ—¶é—´
const formatTime = (time: string) => {
  return formatDistanceToNow(new Date(time), {
    addSuffix: true,
    locale: zhCN
  })
}

// è·å–å®éªŒå®¤åç§°
const getLabName = (labId: number) => {
  const lab = laboratories.value.find(l => l.id === labId)
  return lab?.name || `å®éªŒå®¤${labId}`
}

onMounted(() => {
  loadLaboratories()
  loadAlarms()

  // å®šæ—¶åˆ·æ–°æ•°æ®
  setInterval(() => {
    loadAlarms()
  }, 30000) // 30ç§’åˆ·æ–°ä¸€æ¬¡
})
</script>

<style lang="scss" scoped>
.dashboard {
  .stats-cards {
    margin-bottom: 20px;
  }

  .stat-card {
    .stat-content {
      display: flex;
      align-items: center;

      .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        margin-right: 16px;
      }

      .stat-info {
        flex: 1;

        .stat-title {
          font-size: 14px;
          color: #909399;
          margin-bottom: 8px;
        }

        .stat-value {
          font-size: 24px;
          font-weight: 600;
          color: #303133;
          margin-bottom: 4px;
        }

        .stat-trend {
          font-size: 12px;
          display: flex;
          align-items: center;

          &.up {
            color: #67c23a;
          }

          &.down {
            color: #f56c6c;
          }

          .el-icon {
            margin-right: 4px;
          }
        }
      }
    }
  }

  .monitoring-section,
  .charts-section {
    margin-bottom: 20px;
  }

  .alarm-badge {
    margin-left: 12px;
  }

  .alarm-list {
    max-height: 400px;
    overflow-y: auto;
  }

  .alarm-item {
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 8px;
    border-left: 4px solid;

    &.high {
      background: #fef0f0;
      border-left-color: #f56c6c;
    }

    &.medium {
      background: #fdf6ec;
      border-left-color: #e6a23c;
    }

    &.low {
      background: #f4f4f5;
      border-left-color: #909399;
    }

    .alarm-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;

      .alarm-time {
        font-size: 12px;
        color: #909399;
      }
    }

    .alarm-content {
      font-size: 14px;
      color: #303133;
      margin-bottom: 4px;
    }

    .alarm-lab {
      font-size: 12px;
      color: #606266;
    }
  }
}
</style>
```

## ğŸ”Œ APIé›†æˆ

### 1. HTTPè¯·æ±‚å°è£… (src/utils/request.ts)

```typescript
import axios, { AxiosRequestConfig, AxiosResponse } from 'axios'
import { ElMessage, ElMessageBox } from 'element-plus'
import { useAuthStore } from '@/stores/auth'

// å“åº”æ¥å£
export interface ApiResponse<T = any> {
  code: number
  message: string
  data: T
  timestamp: number
}

// åˆ›å»ºaxioså®ä¾‹
const request = axios.create({
  baseURL: '/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// è¯·æ±‚æ‹¦æˆªå™¨
request.interceptors.request.use(
  (config) => {
    const authStore = useAuthStore()

    // æ·»åŠ token
    if (authStore.token) {
      config.headers.Authorization = `Bearer ${authStore.token}`
    }

    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨
request.interceptors.response.use(
  (response: AxiosResponse<ApiResponse>) => {
    const { code, message, data } = response.data

    // è¯·æ±‚æˆåŠŸ
    if (code === 200) {
      return response.data
    }

    // ä¸šåŠ¡é”™è¯¯
    ElMessage.error(message || 'è¯·æ±‚å¤±è´¥')
    return Promise.reject(new Error(message || 'è¯·æ±‚å¤±è´¥'))
  },
  (error) => {
    const { response } = error

    if (response) {
      switch (response.status) {
        case 401:
          ElMessageBox.confirm('ç™»å½•çŠ¶æ€å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•', 'æç¤º', {
            confirmButtonText: 'é‡æ–°ç™»å½•',
            cancelButtonText: 'å–æ¶ˆ',
            type: 'warning'
          }).then(() => {
            const authStore = useAuthStore()
            authStore.logout()
            window.location.reload()
          })
          break
        case 403:
          ElMessage.error('æ²¡æœ‰æƒé™è®¿é—®')
          break
        case 404:
          ElMessage.error('è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨')
          break
        case 500:
          ElMessage.error('æœåŠ¡å™¨å†…éƒ¨é”™è¯¯')
          break
        default:
          ElMessage.error('ç½‘ç»œé”™è¯¯')
      }
    } else {
      ElMessage.error('ç½‘ç»œè¿æ¥å¤±è´¥')
    }

    return Promise.reject(error)
  }
)

export default request
```

### 2. APIæ¥å£å®šä¹‰ (src/api/monitor.ts)

```typescript
import request from '@/utils/request'
import type { LabEnvironmentData, Laboratory, LabAlarm } from '@/types'

// è·å–å®éªŒå®¤åˆ—è¡¨
export const getLaboratories = () => {
  return request.get<Laboratory[]>('/system/laboratories')
}

// è·å–å®æ—¶æ•°æ®
export const getRealtimeData = (labId: number) => {
  return request.get<LabEnvironmentData>(`/monitor/realtime/${labId}`)
}

// è·å–å†å²æ•°æ®
export const getHistoryData = (params: {
  labId: number
  startTime: string
  endTime: string
}) => {
  return request.get<LabEnvironmentData[]>('/monitor/history', { params })
}

// è·å–æœ€è¿‘å‘Šè­¦
export const getRecentAlarms = () => {
  return request.get<LabAlarm[]>('/monitor/alarms/recent')
}

// ä¸ŠæŠ¥ç¯å¢ƒæ•°æ®
export const reportEnvironmentData = (data: LabEnvironmentData) => {
  return request.post<void>('/monitor/data/report', data)
}
```

## ğŸ“¦ æ„å»ºéƒ¨ç½²

### 1. Dockeréƒ¨ç½²

```dockerfile
# Dockerfile
FROM node:18-alpine as builder

WORKDIR /app

# å¤åˆ¶packageæ–‡ä»¶
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm ci --only=production

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN npm run build

# ç”Ÿäº§ç¯å¢ƒ
FROM nginx:alpine

# å¤åˆ¶æ„å»ºç»“æœ
COPY --from=builder /app/dist /usr/share/nginx/html

# å¤åˆ¶nginxé…ç½®
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

### 2. nginxé…ç½®

```nginx
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Gzipå‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # å‰ç«¯è·¯ç”±
    location / {
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://backend:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocketä»£ç†
    location /ws/ {
        proxy_pass http://backend:8080/ws/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

## ğŸ¯ å¼€å‘è§„èŒƒ

### 1. ä»£ç è§„èŒƒ
- ä½¿ç”¨TypeScriptè¿›è¡Œç±»å‹æ£€æŸ¥
- éµå¾ªVue 3ç»„åˆå¼APIè§„èŒƒ
- ä½¿ç”¨ESLintå’ŒPrettierä¿è¯ä»£ç è´¨é‡
- ç»„ä»¶å‘½åä½¿ç”¨PascalCase
- æ–‡ä»¶å‘½åä½¿ç”¨kebab-case

### 2. æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨è·¯ç”±æ‡’åŠ è½½
- ç»„ä»¶æŒ‰éœ€å¼•å…¥
- å›¾ç‰‡èµ„æºä¼˜åŒ–
- åˆç†ä½¿ç”¨ç¼“å­˜ç­–ç•¥
- é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“

### 3. å®‰å…¨è€ƒè™‘
- XSSé˜²æŠ¤
- CSRFé˜²æŠ¤
- æ•æ„Ÿä¿¡æ¯åŠ å¯†
- æ¥å£æƒé™æ§åˆ¶
- è¾“å…¥æ•°æ®éªŒè¯

## ğŸ“ æ€»ç»“

æœ¬å‰ç«¯å®ç°æŒ‡å—æä¾›äº†å®Œæ•´çš„å‰ç«¯å¼€å‘æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š
- ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆé€‰æ‹©
- å®Œæ•´çš„é¡¹ç›®ç»“æ„è®¾è®¡
- æ ¸å¿ƒç»„ä»¶å’Œé¡µé¢å®ç°
- APIé›†æˆæ–¹æ¡ˆ
- æ„å»ºéƒ¨ç½²é…ç½®
- å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µ

é€šè¿‡æœ¬æŒ‡å—ï¼Œå¯ä»¥å¿«é€Ÿæ­å»ºä¸€ä¸ªåŠŸèƒ½å®Œå–„ã€æ€§èƒ½ä¼˜è‰¯ã€ç”¨æˆ·ä½“éªŒè‰¯å¥½çš„æ±¡æ°´å¤„ç†ç›‘æµ‹ç³»ç»Ÿå‰ç«¯åº”ç”¨ã€‚